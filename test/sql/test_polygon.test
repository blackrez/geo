# name: test/sql/test_polygon.test
# description: POLYGON tests
# group: [sql]

statement ok
LOAD 'build/release/extension/geo/geo.duckdb_extension';

statement ok
PRAGMA enable_verification

statement ok
CREATE TABLE geometries (g Geometry);

# Insert valid geometry strings
statement ok
INSERT INTO geometries VALUES('0103000000010000000B00000033333333C7A80C4166666666D7732B410000000084AC0C416666666601732B410000000010AD0C41CDCCCCCCD8722B41CDCCCCCC14AE0C41CDCCCCCC39722B4100000000C4AB0C416666666601722B410000000058AC0C41CDCCCCCCAA712B410000000084AF0C410000000092702B41CDCCCCCC54AC0C4100000000FA6F2B419A99999919A80C41CDCCCCCC6E712B419A999999A5A30C41CDCCCCCC66722B4133333333C7A80C4166666666D7732B41'), ('010200000004000000CB49287D21C451C0000000000000084000000000000012405917B7D1009E1640F0BF95ECD8A4454000000000000014400000000000001C40D8F0F44A59662040'), ('01030000800100000005000000000000000000000000000000000000000000000000000000000000000000000000000000000014400000000000000000000000000000144000000000000014400000000000000000000000000000144000000000000000000000000000000000000000000000000000000000000000000000000000000000')

query T
SELECT * FROM geometries
----
0103000000010000000B00000033333333C7A80C4166666666D7732B410000000084AC0C416666666601732B410000000010AD0C41CDCCCCCCD8722B41CDCCCCCC14AE0C41CDCCCCCC39722B4100000000C4AB0C416666666601722B410000000058AC0C41CDCCCCCCAA712B410000000084AF0C410000000092702B41CDCCCCCC54AC0C4100000000FA6F2B419A99999919A80C41CDCCCCCC6E712B419A999999A5A30C41CDCCCCCC66722B4133333333C7A80C4166666666D7732B41
010200000004000000CB49287D21C451C0000000000000084000000000000012405917B7D1009E1640F0BF95ECD8A4454000000000000014400000000000001C40D8F0F44A59662040
01030000800100000005000000000000000000000000000000000000000000000000000000000000000000000000000000000014400000000000000000000000000000144000000000000014400000000000000000000000000000144000000000000000000000000000000000000000000000000000000000000000000000000000000000

query T
SELECT ST_ASTEXT(g) FROM geometries
----
POLYGON((234776.9 899563.7,234896.5 899456.7,234914 899436.4,234946.6 899356.9,234872.5 899328.7,234891 899285.4,234992.5 899145,234890.6 899069,234755.2 899255.4,234612.7 899379.4,234776.9 899563.7))
LINESTRING(-71.064544 3,4.5 5.6543,43.28787 5,7 8.1999)
POLYGON Z ((0 0 0,0 5 0,5 5 0,5 0 0,0 0 0))

statement error
INSERT INTO geometries(('0103000000010000000B00000033333333C7A80C4166666666D7732B410000000084AC0C416666666601732B410000000010AD0C41CDCCCCCCD8722B41CDCCCCCC14AE0C41CDCCCCCC39722B4100000000C4AB0C416666666601722B410000000058AC0C41CDCCCCCCAA712B410000000084AF0C410000000092702B41CDCCCCCC54AC0C4100000000FA6F2B419A99999919A80C41CDCCCCCC6E712B419A999999A5A30C41CDCCCCCC66722B4133333333C7A80C4166666666D7732B414'))

# Insert valid strings with text
statement ok
DELETE FROM geometries

statement ok
INSERT INTO geometries VALUES('POLYGON((234776.9 899563.7,234896.5 899456.7,234914 899436.4,234946.6 899356.9,234872.5 899328.7,234891 899285.4,234992.5 899145,234890.6 899069,234755.2 899255.4,234612.7 899379.4,234776.9 899563.7))'), ('POLYGON((0 0 0,0 5 0,5 5 0,5 0 0,0 0 0))'), ('POLYGON((-8149362 5132394 1,-8149446 5132501 1,-8149548 5132597 1.72,-8149695 5132675 1,-8149362 5132394 1.11))')

query T
SELECT * FROM geometries
----
0103000000010000000B00000033333333C7A80C4166666666D7732B410000000084AC0C416666666601732B410000000010AD0C41CDCCCCCCD8722B41CDCCCCCC14AE0C41CDCCCCCC39722B4100000000C4AB0C416666666601722B410000000058AC0C41CDCCCCCCAA712B410000000084AF0C410000000092702B41CDCCCCCC54AC0C4100000000FA6F2B419A99999919A80C41CDCCCCCC6E712B419A999999A5A30C41CDCCCCCC66722B4133333333C7A80C4166666666D7732B41
01030000800100000005000000000000000000000000000000000000000000000000000000000000000000000000000000000014400000000000000000000000000000144000000000000014400000000000000000000000000000144000000000000000000000000000000000000000000000000000000000000000000000000000000000
01030000800100000005000000000000805C165FC1000000801A945341000000000000F03F0000008071165FC10000004035945341000000000000F03F000000008B165FC1000000404D94534185EB51B81E85FB3F000000C0AF165FC1000000C060945341000000000000F03F000000805C165FC1000000801A945341C3F5285C8FC2F13F

query T
SELECT ST_ASTEXT(g) FROM geometries
----
POLYGON((234776.9 899563.7,234896.5 899456.7,234914 899436.4,234946.6 899356.9,234872.5 899328.7,234891 899285.4,234992.5 899145,234890.6 899069,234755.2 899255.4,234612.7 899379.4,234776.9 899563.7))
POLYGON Z ((0 0 0,0 5 0,5 5 0,5 0 0,0 0 0))
POLYGON Z ((-8149362 5132394 1,-8149446 5132501 1,-8149548 5132597 1.72,-8149695 5132675 1,-8149362 5132394 1.11))

statement error
INSERT INTO geometries(('POLYGON(-71.064544 42.28787)'))

# Insert valid strings with geojson
statement ok
DELETE FROM geometries

statement ok
INSERT INTO geometries VALUES('{"type":"Polygon","coordinates":[[[42,42],[45,45],[45,42],[42,42]]]}'), ('{"type":"Polygon","coordinates":[[[0,0],[1,1],[0,1],[0,0]]]}'), ('{"type":"Polygon","coordinates":[[[42,42.23],[45,45.56],[45,42],[42,42.11]]]}')

query T
SELECT * FROM geometries
----
0103000000010000000400000000000000000045400000000000004540000000000080464000000000008046400000000000804640000000000000454000000000000045400000000000004540
0103000000010000000400000000000000000000000000000000000000000000000000F03F000000000000F03F0000000000000000000000000000F03F00000000000000000000000000000000
0103000000010000000400000000000000000045403D0AD7A3701D4540000000000080464048E17A14AEC74640000000000080464000000000000045400000000000004540AE47E17A140E4540

query T
SELECT ST_ASTEXT(g) FROM geometries
----
POLYGON((42 42,45 45,45 42,42 42))
POLYGON((0 0,1 1,0 1,0 0))
POLYGON((42 42.23,45 45.56,45 42,42 42.11))

# Insert invalid geojson string
statement error
INSERT INTO geometries(('{"type":"Polygon","coordinates":[30,10.2323]}'))
