# name: test/sql/test_centroid.test
# description: ST_CENTROID test
# group: [sql]

statement ok
LOAD 'build/release/extension/geo/geo.duckdb_extension';

statement ok
PRAGMA enable_verification

#test with POINT
query I
SELECT ST_CENTROID('POINT(30 10.2323)')
----
01010000000000000000003E40BBB88D06F0762440

query I 
SELECT ST_CENTROID('010100000000000000000024400000000000004B40')
----
010100000000000000000024400000000000004B40

query I 
SELECT ST_CENTROID('{"type":"Point","coordinates":[-71.064544,10.2323]}')
----
0101000000CB49287D21C451C0BBB88D06F0762440

#test with LINESTRING
query I
SELECT ST_ASTEXT(ST_CENTROID('SRID=4326;LINESTRING(-72.1260 42.45, -72.1240 42.45666, -72.123 42.1546)'))
----
POINT(-72.1235318788721 42.30889189337564)

query I 
SELECT ST_ASTEXT(ST_CENTROID('010200000007000000000000004ac5264100000000207f464100000000c4c3264100000000f07e46410000000076c2264100000080c97e46410000000018c2264100000000ba7e464100000000e0c1264100000000ab7e464100000000b4c1264100000000907e4641000000009ac12641000000806f7e4641'))
----
POINT(173.1369227562201 6.024997378587192)

query I 
SELECT ST_ASTEXT(ST_CENTROID('{"type":"LineString","coordinates":[[1,1],[2,2],[3,3],[4,4]]}'))
----
POINT(2.499047675859585 2.500094753098866)

#test with POLYGON
query I
SELECT ST_ASTEXT(ST_CENTROID('POLYGON((-71.17166 42.353675,-71.172026 42.354044,-71.17239 42.354358,-71.171794 42.354971,-71.170511 42.354855,-71.17112 42.354238,-71.17166 42.353675))'))
----
POINT(-71.1715376596641 42.35443982052635)

query I 
SELECT ST_ASTEXT(ST_CENTROID('010300000001000000210000009f9eb2d41bf360400000000000c05c4032d435e64fcc6040a9dd02d02eac59406ea475c8695960401f74b91ea4b65640aa5d4db3a73d5f40fd1cf7917cfc534044f2fd6f73475d40ca0d02908c9851400ae3086e83e35a4081446599b0444f40e88b46e15b295840496e29de585a4c404f22fd2fd133554039af2867c08e4a400700000000205240a08535ad90f349407dbb05a05d184e402aaf2867c08e4a404de8723d482d48403b6e29de585a4c40073aee23f9b8424073446599b0444f402837084032e23b40bc0d02908c9851401e89ca3261093440ef1cf7917cfc534024b9a57863692c401174b91ea4b65640e2bca29c013b2540a9dd02d02eac59407916d6b442ce22400000000000c05c40aabca29c013b25405722fd2fd1d35f40ebb8a57863692c40df45a3f0ad646140ca88ca3261093440857104b7c1c16240f036084032e23b4022f9feb7b9f36340cf39ee23f9b84240d5aea6d9d3ee644014e8723d482d48406ea475c869a9654053bb05a05d184e4032d435e64f1c6640f2ffffffff1f52409f9eb2d41b4366403a22fd2fd133554032d435e64f1c6640d38b46e15b2958406ea475c869a965400ae3086e83e35a40d5aea6d9d3ee644044f2fd6f73475d4022f9feb7b9f36340aa5d4db3a73d5f40857104b7c1c162406ea475c8695960400246a3f0ad64614032d435e64fcc60405722fd2fd1d35f409f9eb2d41bf360400000000000c05c40'))
----
POINT(-106.43924717831838 50.11512258120888)

query I 
SELECT ST_ASTEXT(ST_CENTROID('POLYGON((-71.17166 42.353675,-71.172026 42.354044,-71.17239 42.354358,-71.171794 42.354971,-71.170511 42.354855,-71.17112 42.354238,-71.17166 42.353675))'))
----
POINT(-71.1715376596641 42.35443982052635)

#test with MULTIPOINT
query I
SELECT ST_ASTEXT(ST_CENTROID('MULTIPOINT(-70.9590 42.1180, -70.9611 42.1223, -71.17166 42.353675,-71.172026 42.354044,-71.17239 42.354358,-71.171794 42.354971)'))
----
POINT(-71.10115354287964 42.276268118668774)

query I 
SELECT ST_ASTEXT(ST_CENTROID('0104000000060000000101000000cdccccccccccec3fcdccccccccccec3f0101000000cdccccccccccec3fcdccccccccccec3f0101000000cdccccccccccec3fcdccccccccccec3f0101000000cdccccccccccec3fcdccccccccccec3f0101000000cdccccccccccec3fcdccccccccccec3f0101000000cdccccccccccec3fcdccccccccccec3f'))
----
POINT(0.9 0.899999999999995)

query I 
SELECT ST_ASTEXT(ST_CENTROID('{"type":"MultiPoint","coordinates":[[35,14]]}'))
----
POINT(35 13.999999999999995)

#test with MULTILINESTRING
query I
SELECT ST_ASTEXT(ST_CENTROID('MULTILINESTRING((-118.584 38.374 20,-118.583 38.5 30),(-71.05957 42.3589 75, -71.061 43 90))'))
----
POINT(-78.76654382473521 43.376066046403935)

query I 
SELECT ST_ASTEXT(ST_CENTROID('01050000C00200000001020000C004000000000000000000000000000000000000000000000000000000000000000000F03F00000000000000000000000000001440000000000000000000000000000000400000000000001440000000000000000000000000000000000000000000000840000000000000000000000000000000000000000000000000000000000000104001020000C004000000000000000000F03F000000000000F03F0000000000000000000000000000F03F0000000000000840000000000000F03F0000000000000000000000000000F03F000000000000F03F00000000000008400000000000000000000000000000F03F000000000000F03F000000000000F03F0000000000000000000000000000F03F'))
----
POINT(1.751739668234009 1.751131764312844)

query I 
SELECT ST_ASTEXT(ST_CENTROID('{"type":"MultiLineString","coordinates":[[[-89.734634999999997,31.492072000000000],[-89.734955999999997,31.492237999999997]]]}'))
----
POINT(-89.73479549985757 31.492155000100137)

#test with MULTIPOLYGON
query I
SELECT ST_ASTEXT(ST_CENTROID('MULTIPOLYGON(((26 125,26 200,126 200,126 125,101 100,26 125),(51 150,101 150,76 175,51 150)),((151 100,151 200,176 175,151 100)))'))
----
POINT(-84.92362281599351 35.5844933563238)

query I 
SELECT ST_ASTEXT(ST_CENTROID('MULTIPOLYGON(((-71.1031880899493 42.3152774590236,-71.1031627617667 42.3152960829043,-71.102923838298 42.3149156848307,-71.1023097974109 42.3151969047397,-71.1019285062273 42.3147384934248,-71.102505233663 42.3144722937587,-71.10277487471 42.3141658254797,-71.103113945163 42.3142739188902,-71.10324876416 42.31402489987,-71.1033002961013 42.3140393340215,-71.1033488797549 42.3139495090772,-71.103396240451 42.3138632439557,-71.1041521907712 42.3141153348029,-71.1041411411543 42.3141545014533,-71.1041287795912 42.3142114839058,-71.1041188134329 42.3142693656241,-71.1041112482575 42.3143272556118,-71.1041072845732 42.3143851580048,-71.1041057218871 42.3144430686681,-71.1041065602059 42.3145009876017,-71.1041097995362 42.3145589148055,-71.1041166403905 42.3146168544148,-71.1041258822717 42.3146748022936,-71.1041375307579 42.3147318674446,-71.1041492906949 42.3147711126569,-71.1041598612795 42.314808571739,-71.1042515013869 42.3151287620809,-71.1041173835118 42.3150739481917,-71.1040809891419 42.3151344119048,-71.1040438678912 42.3151191367447,-71.1040194562988 42.3151832057859,-71.1038734225584 42.3151140942995,-71.1038446938243 42.3151006300338,-71.1038315271889 42.315094347535,-71.1037393329282 42.315054824985,-71.1035447555574 42.3152608696313,-71.1033436658644 42.3151648370544,-71.1032580383161 42.3152269126061,-71.103223066939 42.3152517403219,-71.1031880899493 42.3152774590236)),((-71.1043632495873 42.315113108546,-71.1043583974082 42.3151211109857,-71.1043443253471 42.3150676015829,-71.1043850704575 42.3150793250568,-71.1043632495873 42.315113108546)))'))
----
POINT(-71.10326502466101 42.31476573757229)

#test with COLLECTION
statement error
SELECT ST_ASTEXT(ST_CENTROID('GEOMETRYCOLLECTION(POLYGON((-71.040878 42.285678,-71.040943 42.2856,-71.04096 42.285752,-71.040878 42.285678)),LINESTRING(-71.160281 42.258729,-71.160837 42.259113,-71.161144 42.25932))'))

statement error 
SELECT ST_ASTEXT(ST_CENTROID('010700000004000000010300000001000000060000000000000000805BC0A6AAAAAAAAAA45400000000000805BC00000000000E0704000000000002059400000000000E070404016B29085AC4D4041BDE94D6F9A6040E6A28B2EBA684240D345175D741157400000000000805BC0A6AAAAAAAAAA4540010300000001000000050000000000000000C06C400000000000C047400000000000C06C40C36DDBB66DDB46C0E6A28B2EBA684240D345175D741157404016B29085AC4D4041BDE94D6F9A60400000000000C06C400000000000C04740010300000001000000060000000000000000C06C40C36DDBB66DDB46C00000000000C06C4000000000008056C00000000000805BC000000000008056C00000000000805BC0A6AAAAAAAAAA4540E6A28B2EBA684240D345175D741157400000000000C06C40C36DDBB66DDB46C00103000000010000000500000000000000002059400000000000E070400000000000C06C400000000000E070400000000000C06C400000000000C047404016B29085AC4D4041BDE94D6F9A604000000000002059400000000000E07040'))

statement error 
SELECT ST_ASTEXT(ST_CENTROID('{"type":"GeometryCollection","geometries":[{"type":"MultiPoint","coordinates":[[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,32],[-117,32],[-117,32],[-117,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-117,32],[-117,32],[-117,32],[-117,32]]},{"type":"MultiLineString","coordinates":[[[-89.734634999999997,31.492072000000000],[-89.734955999999997,31.492237999999997]]]},{"type":"MultiPolygon","coordinates":[[[[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,32],[-117,32],[-117,32],[-117,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-117,32],[-117,32],[-117,32],[-117,32]],[[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,32],[-117,33]]]]}]}'))

#test with NULL and empty value
query I
SELECT ST_CENTROID('')
----
(empty)

query I 
SELECT ST_CENTROID(NULL)
----
NULL

# test with invalid input
statement error
SELECT ST_CENTROID(22)

# test with table
statement ok
CREATE TABLE geographies (g Geography);

statement ok
INSERT INTO geographies VALUES('MULTIPOINT(0.9 0.9,0.9 0.9,0.9 0.9,0.9 0.9,0.9 0.9,0.9 0.9)'::GEOGRAPHY), ('01010000000000000000003E40BBB88D06F0762440'), ('POLYGON((-71.040878 42.285678,-71.040943 42.2856,-71.04096 42.285752,-71.040878 42.285678))'::GEOGRAPHY), ('0101000000CB49287D21C451C0F0BF95ECD8A44540')

query R
SELECT ST_ASTEXT(ST_CENTROID(g)) FROM geographies
----
POINT(0.9 0.899999999999995)
POINT(30 10.2323)
POINT(-71.04092699999369 42.285676666672096)
POINT(-71.064544 43.28787)

statement ok
INSERT INTO geographies VALUES(''::GEOGRAPHY), (NULL::GEOGRAPHY), ('POINT(10 54)')

query R
SELECT ST_ASTEXT(ST_CENTROID(g)) FROM geographies
----
POINT(0.9 0.899999999999995)
POINT(30 10.2323)
POINT(-71.04092699999369 42.285676666672096)
POINT(-71.064544 43.28787)
(empty)
NULL
POINT(10 54)
