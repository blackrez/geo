# name: test/sql/test_collection.test
# description: GEOMETRYCOLLECTION tests
# group: [sql]

statement ok
LOAD 'build/release/extension/geo/geo.duckdb_extension';

statement ok
PRAGMA enable_verification

statement ok
CREATE TABLE geographies (g Geography);

# Insert valid geometry strings
statement ok
INSERT INTO geographies VALUES('010700008003000000010100008000000000000000C00000000000000840000000000000F03F010200008002000000000000000000144000000000000014400000000000001440000000000000244000000000000024400000000000002440010300008001000000040000000000000000001CC0CDCCCCCCCCCC104000000000000014406666666666661CC0CDCCCCCCCCCC104000000000000014406666666666661CC0333333333333114000000000000014400000000000001CC0CDCCCCCCCCCC10400000000000001440'), ('010700000004000000010300000001000000060000000000000000805BC0A6AAAAAAAAAA45400000000000805BC00000000000E0704000000000002059400000000000E070404016B29085AC4D4041BDE94D6F9A6040E6A28B2EBA684240D345175D741157400000000000805BC0A6AAAAAAAAAA4540010300000001000000050000000000000000C06C400000000000C047400000000000C06C40C36DDBB66DDB46C0E6A28B2EBA684240D345175D741157404016B29085AC4D4041BDE94D6F9A60400000000000C06C400000000000C04740010300000001000000060000000000000000C06C40C36DDBB66DDB46C00000000000C06C4000000000008056C00000000000805BC000000000008056C00000000000805BC0A6AAAAAAAAAA4540E6A28B2EBA684240D345175D741157400000000000C06C40C36DDBB66DDB46C00103000000010000000500000000000000002059400000000000E070400000000000C06C400000000000E070400000000000C06C400000000000C047404016B29085AC4D4041BDE94D6F9A604000000000002059400000000000E07040'), ('010700008003000000010100008000000000000000C00000000000000840000000000000F03F010200008002000000000000000000144000000000000014400000000000001440000000000000244000000000000024400000000000002440010300008001000000040000000000000000001CC0CDCCCCCCCCCC104000000000000014406666666666661CC0CDCCCCCCCCCC104000000000000014406666666666661CC0333333333333114000000000000014400000000000001CC0CDCCCCCCCCCC10400000000000001440'), ('010700000003000000010300000003000000050000000000000000000000000000000000000000000000000000000000000000002440000000000000244000000000000024400000000000002440000000000000000000000000000000000000000000000000050000000000000000001840000000000000184000000000000020400000000000001840000000000000204000000000000020400000000000001840000000000000204000000000000018400000000000001840050000000000000000000040000000000000004000000000000010400000000000000040000000000000104000000000000010400000000000000040000000000000104000000000000000400000000000000040010500000002000000010200000002000000000000000000004000000000000000400000000000000840000000000000084001020000000200000000000000000000000000000000000000000000000000F03F000000000000F03F010100000000000000000000400000000000000840')

query T
SELECT * FROM geographies
----
010700008003000000010100008000000000000000C00000000000000840000000000000F03F010200008002000000000000000000144000000000000014400000000000001440000000000000244000000000000024400000000000002440010300008001000000040000000000000000001CC0CDCCCCCCCCCC104000000000000014406666666666661CC0CDCCCCCCCCCC104000000000000014406666666666661CC0333333333333114000000000000014400000000000001CC0CDCCCCCCCCCC10400000000000001440
010700000004000000010300000001000000060000000000000000805BC0A6AAAAAAAAAA45400000000000805BC00000000000E0704000000000002059400000000000E070404016B29085AC4D4041BDE94D6F9A6040E6A28B2EBA684240D345175D741157400000000000805BC0A6AAAAAAAAAA4540010300000001000000050000000000000000C06C400000000000C047400000000000C06C40C36DDBB66DDB46C0E6A28B2EBA684240D345175D741157404016B29085AC4D4041BDE94D6F9A60400000000000C06C400000000000C04740010300000001000000060000000000000000C06C40C36DDBB66DDB46C00000000000C06C4000000000008056C00000000000805BC000000000008056C00000000000805BC0A6AAAAAAAAAA4540E6A28B2EBA684240D345175D741157400000000000C06C40C36DDBB66DDB46C00103000000010000000500000000000000002059400000000000E070400000000000C06C400000000000E070400000000000C06C400000000000C047404016B29085AC4D4041BDE94D6F9A604000000000002059400000000000E07040
010700008003000000010100008000000000000000C00000000000000840000000000000F03F010200008002000000000000000000144000000000000014400000000000001440000000000000244000000000000024400000000000002440010300008001000000040000000000000000001CC0CDCCCCCCCCCC104000000000000014406666666666661CC0CDCCCCCCCCCC104000000000000014406666666666661CC0333333333333114000000000000014400000000000001CC0CDCCCCCCCCCC10400000000000001440
010700000003000000010300000003000000050000000000000000000000000000000000000000000000000000000000000000002440000000000000244000000000000024400000000000002440000000000000000000000000000000000000000000000000050000000000000000001840000000000000184000000000000020400000000000001840000000000000204000000000000020400000000000001840000000000000204000000000000018400000000000001840050000000000000000000040000000000000004000000000000010400000000000000040000000000000104000000000000010400000000000000040000000000000104000000000000000400000000000000040010500000002000000010200000002000000000000000000004000000000000000400000000000000840000000000000084001020000000200000000000000000000000000000000000000000000000000F03F000000000000F03F010100000000000000000000400000000000000840

query T
SELECT ST_ASTEXT(g) FROM geographies
----
GEOMETRYCOLLECTION Z (POINT Z (-2 3 1),LINESTRING Z (5 5 5,10 10 10),POLYGON Z ((-7 4.2 5,-7.1 4.2 5,-7.1 4.3 5,-7 4.2 5)))
GEOMETRYCOLLECTION(POLYGON((-110 43.3333333333333,-110 270,100.5 270,59.3478260869565 132.826086956522,36.8181818181818 92.2727272727273,-110 43.3333333333333)),POLYGON((230 47.5,230 -45.7142857142858,36.8181818181818 92.2727272727273,59.3478260869565 132.826086956522,230 47.5)),POLYGON((230 -45.7142857142858,230 -90,-110 -90,-110 43.3333333333333,36.8181818181818 92.2727272727273,230 -45.7142857142858)),POLYGON((100.5 270,230 270,230 47.5,59.3478260869565 132.826086956522,100.5 270)))
GEOMETRYCOLLECTION Z (POINT Z (-2 3 1),LINESTRING Z (5 5 5,10 10 10),POLYGON Z ((-7 4.2 5,-7.1 4.2 5,-7.1 4.3 5,-7 4.2 5)))
GEOMETRYCOLLECTION(POLYGON((0 0,0 10,10 10,10 0,0 0),(6 6,8 6,8 8,6 8,6 6),(2 2,4 2,4 4,2 4,2 2)),MULTILINESTRING((2 2,3 3),(0 0,1 1)),POINT(2 3))

statement error
INSERT INTO geographies(('010700000003000000010300000003000000050000000000000000000000000000000000000000000000000000000000000000002440000000000000244000000000000024400000000000002440000000000000000000000000000000000000000000000000050000000000000000001840000000000000184000000000000020400000000000001840000000000000204000000000000020400000000000001840000000000000204000000000000018400000000000001840050000000000000000000040000000000000004000000000000010400000000000000040000000000000104000000000000010400000000000000040000000000000104000000000000000400000000000000040010500000002000000010200000002000000000000000000004000000000000000400000000000000840000000000000084001020000000200000000000000000000000000000000000000000000000000F03F000000000000F03F01010000000000000000000040000000000000084022'))

# Insert valid strings with text
statement ok
DELETE FROM geographies

statement ok
INSERT INTO geographies VALUES('GEOMETRYCOLLECTION(POINT(-2 3 1),LINESTRING(5 5 5,10 10 10),POLYGON((-7 4.2 5,-7.1 4.2 5,-7.1 4.3 5,-7 4.2 5)))'), ('GEOMETRYCOLLECTION(POLYGON((-110 43.3333333333333,-110 270,100.5 270,59.3478260869565 132.826086956522,36.8181818181818 92.2727272727273,-110 43.3333333333333)),POLYGON((230 47.5,230 -45.7142857142858,36.8181818181818 92.2727272727273,59.3478260869565 132.826086956522,230 47.5)),POLYGON((230 -45.7142857142858,230 -90,-110 -90,-110 43.3333333333333,36.8181818181818 92.2727272727273,230 -45.7142857142858)),POLYGON((100.5 270,230 270,230 47.5,59.3478260869565 132.826086956522,100.5 270)))'), ('GEOMETRYCOLLECTION(POLYGON((0 0,0 10,10 10,10 0,0 0),(6 6,8 6,8 8,6 8,6 6),(2 2,4 2,4 4,2 4,2 2)),MULTILINESTRING((2 2,3 3),(0 0,1 1)),POINT(2 3))')

query T
SELECT * FROM geographies
----
010700008003000000010100008000000000000000C00000000000000840000000000000F03F010200008002000000000000000000144000000000000014400000000000001440000000000000244000000000000024400000000000002440010300008001000000040000000000000000001CC0CDCCCCCCCCCC104000000000000014406666666666661CC0CDCCCCCCCCCC104000000000000014406666666666661CC0333333333333114000000000000014400000000000001CC0CDCCCCCCCCCC10400000000000001440
010700000004000000010300000001000000060000000000000000805BC0A6AAAAAAAAAA45400000000000805BC00000000000E0704000000000002059400000000000E070404016B29085AC4D4041BDE94D6F9A6040E6A28B2EBA684240D345175D741157400000000000805BC0A6AAAAAAAAAA4540010300000001000000050000000000000000C06C400000000000C047400000000000C06C40C36DDBB66DDB46C0E6A28B2EBA684240D345175D741157404016B29085AC4D4041BDE94D6F9A60400000000000C06C400000000000C04740010300000001000000060000000000000000C06C40C36DDBB66DDB46C00000000000C06C4000000000008056C00000000000805BC000000000008056C00000000000805BC0A6AAAAAAAAAA4540E6A28B2EBA684240D345175D741157400000000000C06C40C36DDBB66DDB46C00103000000010000000500000000000000002059400000000000E070400000000000C06C400000000000E070400000000000C06C400000000000C047404016B29085AC4D4041BDE94D6F9A604000000000002059400000000000E07040
010700000003000000010300000003000000050000000000000000000000000000000000000000000000000000000000000000002440000000000000244000000000000024400000000000002440000000000000000000000000000000000000000000000000050000000000000000001840000000000000184000000000000020400000000000001840000000000000204000000000000020400000000000001840000000000000204000000000000018400000000000001840050000000000000000000040000000000000004000000000000010400000000000000040000000000000104000000000000010400000000000000040000000000000104000000000000000400000000000000040010500000002000000010200000002000000000000000000004000000000000000400000000000000840000000000000084001020000000200000000000000000000000000000000000000000000000000F03F000000000000F03F010100000000000000000000400000000000000840

query T
SELECT ST_ASTEXT(g) FROM geographies
----
GEOMETRYCOLLECTION Z (POINT Z (-2 3 1),LINESTRING Z (5 5 5,10 10 10),POLYGON Z ((-7 4.2 5,-7.1 4.2 5,-7.1 4.3 5,-7 4.2 5)))
GEOMETRYCOLLECTION(POLYGON((-110 43.3333333333333,-110 270,100.5 270,59.3478260869565 132.826086956522,36.8181818181818 92.2727272727273,-110 43.3333333333333)),POLYGON((230 47.5,230 -45.7142857142858,36.8181818181818 92.2727272727273,59.3478260869565 132.826086956522,230 47.5)),POLYGON((230 -45.7142857142858,230 -90,-110 -90,-110 43.3333333333333,36.8181818181818 92.2727272727273,230 -45.7142857142858)),POLYGON((100.5 270,230 270,230 47.5,59.3478260869565 132.826086956522,100.5 270)))
GEOMETRYCOLLECTION(POLYGON((0 0,0 10,10 10,10 0,0 0),(6 6,8 6,8 8,6 8,6 6),(2 2,4 2,4 4,2 4,2 2)),MULTILINESTRING((2 2,3 3),(0 0,1 1)),POINT(2 3))

statement error
INSERT INTO geographies(('GEOMETRYCOLLECTION(-71.064544 42.28787)'))

# Insert valid strings with geojson
statement ok
DELETE FROM geographies

statement ok
INSERT INTO geographies VALUES('{"type":"GeometryCollection","geometries":[{"type":"Point","coordinates":[30.43,10.2]},{"type":"LineString","coordinates":[[1,2,3],[4,5,6]]},{"type":"Polygon","coordinates":[[[42,42],[45,45],[45,42],[42,42]]]}]}'), ('{"type":"GeometryCollection","geometries":[{"type":"MultiPoint","coordinates":[[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,32],[-117,32],[-117,32],[-117,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-117,32],[-117,32],[-117,32],[-117,32]]},{"type":"MultiLineString","coordinates":[[[-89.734634999999997,31.492072000000000],[-89.734955999999997,31.492237999999997]]]},{"type":"MultiPolygon","coordinates":[[[[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,32],[-117,32],[-117,32],[-117,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-117,32],[-117,32],[-117,32],[-117,32]],[[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,32],[-117,33]]]]}]}'), ('{"type":"GeometryCollection", "geometries":[]}')

query T
SELECT * FROM geographies
----
0107000080030000000101000080AE47E17A146E3E4066666666666624400000000000000000010200008002000000000000000000F03F0000000000000040000000000000084000000000000010400000000000001440000000000000184001030000800100000004000000000000000000454000000000000045400000000000000000000000000080464000000000008046400000000000000000000000000080464000000000000045400000000000000000000000000000454000000000000045400000000000000000
01070000000300000001040000002B00000001010000000000000000405DC0000000000000404001010000000000000000405DC0000000000000404001010000000000000000405DC0000000000000404001010000000000000000405DC0000000000000404001010000000000000000405DC0000000000000404001010000000000000000405DC0000000000000404001010000000000000000405DC0000000000000404001010000000000000000405DC0000000000000404001010000000000000000405DC0000000000000404001010000000000000000405DC0000000000000404001010000000000000000405DC0000000000000404001010000000000000000405DC0000000000000404001010000000000000000405DC0000000000000404001010000000000000000405DC0000000000080404001010000000000000000405DC0000000000080404001010000000000000000405DC0000000000080404001010000000000000000405DC0000000000080404001010000000000000000405DC0000000000080404001010000000000000000405DC0000000000080404001010000000000000000405DC0000000000080404001010000000000000000405DC0000000000080404001010000000000000000405DC0000000000080404001010000000000000000405DC0000000000080404001010000000000000000405DC0000000000080404001010000000000000000405DC0000000000080404001010000000000000000405DC0000000000000404001010000000000000000405DC0000000000000404001010000000000000000405DC0000000000000404001010000000000000000405DC0000000000000404001010000000000000000005DC0000000000000404001010000000000000000005DC0000000000000404001010000000000000000005DC0000000000000404001010000000000000000005DC0000000000000404001010000000000000000005DC0000000000000404001010000000000000000005DC0000000000000404001010000000000000000005DC0000000000000404001010000000000000000005DC0000000000000404001010000000000000000005DC0000000000000404001010000000000000000005DC0000000000000404001010000000000000000405DC0000000000000404001010000000000000000405DC0000000000000404001010000000000000000405DC0000000000000404001010000000000000000405DC00000000000004040010500000001000000010200000002000000CEDF8442046F56C0FE463B6EF87D3F40EFFFE384096F56C033D93F4F037E3F400106000000010000000103000000020000002B0000000000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000005DC000000000000040400000000000005DC000000000000040400000000000005DC000000000000040400000000000005DC000000000000040400000000000005DC000000000000040400000000000005DC000000000000040400000000000005DC000000000000040400000000000005DC000000000000040400000000000005DC000000000000040400000000000005DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC00000000000004040070000000000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000000040400000000000405DC00000000000804040
010700000000000000

query T
SELECT ST_ASTEXT(g) FROM geographies
----
GEOMETRYCOLLECTION Z (POINT Z (30.43 10.2 0),LINESTRING Z (1 2 3,4 5 6),POLYGON Z ((42 42 0,45 45 0,45 42 0,42 42 0)))
GEOMETRYCOLLECTION(MULTIPOINT(-117 32,-117 32,-117 32,-117 32,-117 32,-117 32,-117 32,-117 32,-117 32,-117 32,-117 32,-117 32,-117 32,-117 33,-117 33,-117 33,-117 33,-117 33,-117 33,-117 33,-117 33,-117 33,-117 33,-117 33,-117 33,-117 32,-117 32,-117 32,-117 32,-116 32,-116 32,-116 32,-116 32,-116 32,-116 32,-116 32,-116 32,-116 32,-116 32,-117 32,-117 32,-117 32,-117 32),MULTILINESTRING((-89.734635 31.492072,-89.734956 31.492237999999997)),MULTIPOLYGON(((-117 32,-117 32,-117 32,-117 32,-117 32,-117 32,-117 32,-117 32,-117 32,-117 32,-117 32,-117 32,-117 32,-117 33,-117 33,-117 33,-117 33,-117 33,-117 33,-117 33,-117 33,-117 33,-117 33,-117 33,-117 33,-117 32,-117 32,-117 32,-117 32,-116 32,-116 32,-116 32,-116 32,-116 32,-116 32,-116 32,-116 32,-116 32,-116 32,-117 32,-117 32,-117 32,-117 32),(-117 33,-117 33,-117 33,-117 33,-117 33,-117 32,-117 33))))
GEOMETRYCOLLECTION EMPTY

# Insert invalid geojson string
statement error
INSERT INTO geographies(('{"type":"GeometryCollection","coordinates":[[30,10.2323]}'))
