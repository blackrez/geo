# name: test/sql/function/test_as_binary.test
# description: ST_ASBINARY test
# group: [function]

statement ok
LOAD 'build/release/extension/geo/geo.duckdb_extension';

statement ok
PRAGMA enable_verification

statement ok
CREATE TABLE geographies(g Geography)

statement ok
INSERT INTO geographies VALUES('{"type":"Point","coordinates":[30,10.2323]}'), ('{"type":"Point","coordinates":[-71.064544,10.2323]}'), ('{"type":"Point","coordinates":[30,43.28787]}')

query R
select ST_ASBINARY(g)::VARCHAR from geographies
----
01010000000000000000003E40BBB88D06F0762440
0101000000CB49287D21C451C0BBB88D06F0762440
01010000000000000000003E40F0BF95ECD8A44540

# test with null and empty
statement ok
DELETE FROM geographies

statement ok
INSERT INTO geographies VALUES(''), (NULL)

query R
select ST_ASBINARY(g) from geographies
----
(empty)
NULL

query I
SELECT ST_ASBINARY(ST_MAKEPOINT(5.04, 10.94))
----
0101000000295C8FC2F5281440E17A14AE47E12540

query I
SELECT ST_ASBINARY('MULTIPOINT((20 20), (20 30), (30 20), (190 190))'::GEOGRAPHY)
----
010400000004000000010100000000000000000034400000000000003440010100000000000000000034400000000000003E4001010000000000000000003E40000000000000344001010000000000000000C067400000000000C06740

query I
SELECT ST_ASBINARY(ST_MAKELINE('POINT EMPTY', 'POINT(34 21)'))
----
01020000000100000000000000000041400000000000003540

query I
SELECT ST_ASBINARY('MULTILINESTRING((164 1,18 1,12.2597485145237 2.1418070123307,7.39339828220179 5.39339828220179,5.39339828220179 7.39339828220179,2.14180701233067 12.2597485145237,1 18,1 195),(164 31,46 31,40.2597485145236 32.1418070123307,35.3933982822018 35.3933982822018,32.1418070123307 40.2597485145237,31 46,31 195))'::GEOGRAPHY)
----
0105000000020000000102000000080000000000000000806440000000000000F03F0000000000003240000000000000F03FB420DEC1FD8428403C6E02B76B220140E46FD1FFD6921D40E46FD1FFD6921540E46FD1FFD6921540E46FD1FFD6921D40F86D02B76B220140B420DEC1FD842840000000000000F03F0000000000003240000000000000F03F000000000060684001020000000700000000000000008064400000000000003F4000000000000047400000000000003F401F8877703F214440E42670BB26124040FE2DFADF5AB24140FE2DFADF5AB24140E42670BB261240402D8877703F2144400000000000003F4000000000000047400000000000003F400000000000606840

query I
SELECT ST_ASBINARY('POLYGON((0 0,0 150,150 150,150 0,0 0),(20 20,50 20,50 50,20 50,20 20))'::GEOGRAPHY)
----
010300000002000000050000000000000000000000000000000000000000000000000000000000000000C062400000000000C062400000000000C062400000000000C06240000000000000000000000000000000000000000000000000050000000000000000003440000000000000344000000000000049400000000000003440000000000000494000000000000049400000000000003440000000000000494000000000000034400000000000003440

query I
SELECT ST_ASBINARY('GEOMETRYCOLLECTION(LINESTRING(2.99 90.16,71 74,20 140,171 154),POINT(2.99 90.16),POLYGON((159.33 163.69,171 154,161.31 142.33,159.33 163.69)) )'::GEOGRAPHY)
----
010700000003000000010200000004000000EC51B81E85EB07400AD7A3703D8A56400000000000C05140000000000080524000000000000034400000000000806140000000000060654000000000004063400101000000EC51B81E85EB07400AD7A3703D8A564001030000000100000004000000C3F5285C8FEA6340AE47E17A147664400000000000606540000000000040634052B81E85EB296440C3F5285C8FCA6140C3F5285C8FEA6340AE47E17A14766440

query I
SELECT ST_ASBINARY(NULL)
----
NULL

query I
SELECT ST_ASBINARY('')
----
(empty)

#test with invalid input
statement error
SELECT ST_ASBINARY(22)
