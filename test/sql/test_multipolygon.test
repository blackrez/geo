# name: test/sql/test_multipolygon.test
# description: MULTIPOLYGON tests
# group: [sql]

statement ok
LOAD 'build/release/extension/geo/geo.duckdb_extension';

statement ok
PRAGMA enable_verification

statement ok
CREATE TABLE geographies (g Geography);

# Insert valid geometry strings
statement ok
INSERT INTO geographies VALUES('01060000000100000001030000000100000005000000000000008CAE264100000000BCA34641000000008CAE264100000000CDA3464100000000C2AE264100000000CDA3464100000040C3AE264100000000BCA34641000000008CAE264100000000BCA34641'), ('010500000002000000010200000002000000CEDF8442046F56C0FE463B6EF87D3F401895D409684656C0B81E85EB51383F40010200000002000000CEDF8442046F56C0FE463B6EF87D3F40EFFFE384096F56C093E1783E037E3F40'), ('01060000000100000001030000000100000005000000000000008CAE264100000000BCA34641000000008CAE264100000000CDA3464100000000C2AE264100000000CDA3464100000040C3AE264100000000BCA34641000000008CAE264100000000BCA34641'), ('010600000002000000010300000001000000230000000000000000406740000000000040684000000000006067400000000000406840000000000080674000000000006068400000000000A0674000000000006068400000000000C0674000000000006068400000000000E067400000000000606840000000000000684000000000006068400000000000206840000000000040684000000000004068400000000000406840000000000040684000000000002068400000000000606840000000000000684000000000006068400000000000E0674000000000006068400000000000C0674000000000006068400000000000A067400000000000606840000000000080674000000000004068400000000000606740000000000040684000000000004067400000000000002C4000000000000018400000000000002A40000000000000184000000000000028400000000000001440000000000000264000000000000014400000000000002440000000000000144000000000000022400000000000001440000000000000204000000000000014400000000000001C4000000000000018400000000000001840000000000000184000000000000018400000000000001C40000000000000144000000000000020400000000000001440000000000000224000000000000014400000000000002440000000000000144000000000000026400000000000001440000000000000284000000000000018400000000000002A4000000000000018400000000000002C4000000000004067400000000000406840010300000001000000210000000000000000C0624000000000008056400000000000A06240000000000000544000000000004062400000000000C051400000000000C061400000000000004F400000000000E060400000000000804B40000000000000604000000000000048400000000000C05D4000000000000046400000000000805B4000000000008044400000000000005940000000000000444000000000008056400000000000804440000000000040544000000000000046400000000000005240000000000000484000000000004050400000000000804B400000000000004D400000000000004F400000000000004B400000000000C051400000000000804940000000000000544000000000000049400000000000805640000000000080494000000000000059400000000000004B400000000000405B400000000000004D400000000000805D4000000000004050400000000000405F40000000000000524000000000008060400000000000405440000000000000614000000000008056400000000000606140000000000000594000000000008061400000000000805B4000000000006061400000000000C05D400000000000006140000000000000604000000000008060400000000000E060400000000000405F400000000000C061400000000000805D4000000000004062400000000000405B400000000000A0624000000000000059400000000000C062400000000000805640')

query T
SELECT * FROM geographies
----
01060000000100000001030000000100000005000000000000008CAE264100000000BCA34641000000008CAE264100000000CDA3464100000000C2AE264100000000CDA3464100000040C3AE264100000000BCA34641000000008CAE264100000000BCA34641
010500000002000000010200000002000000CEDF8442046F56C0FE463B6EF87D3F401895D409684656C0B81E85EB51383F40010200000002000000CEDF8442046F56C0FE463B6EF87D3F40EFFFE384096F56C093E1783E037E3F40
01060000000100000001030000000100000005000000000000008CAE264100000000BCA34641000000008CAE264100000000CDA3464100000000C2AE264100000000CDA3464100000040C3AE264100000000BCA34641000000008CAE264100000000BCA34641
010600000002000000010300000001000000230000000000000000406740000000000040684000000000006067400000000000406840000000000080674000000000006068400000000000A0674000000000006068400000000000C0674000000000006068400000000000E067400000000000606840000000000000684000000000006068400000000000206840000000000040684000000000004068400000000000406840000000000040684000000000002068400000000000606840000000000000684000000000006068400000000000E0674000000000006068400000000000C0674000000000006068400000000000A067400000000000606840000000000080674000000000004068400000000000606740000000000040684000000000004067400000000000002C4000000000000018400000000000002A40000000000000184000000000000028400000000000001440000000000000264000000000000014400000000000002440000000000000144000000000000022400000000000001440000000000000204000000000000014400000000000001C4000000000000018400000000000001840000000000000184000000000000018400000000000001C40000000000000144000000000000020400000000000001440000000000000224000000000000014400000000000002440000000000000144000000000000026400000000000001440000000000000284000000000000018400000000000002A4000000000000018400000000000002C4000000000004067400000000000406840010300000001000000210000000000000000C0624000000000008056400000000000A06240000000000000544000000000004062400000000000C051400000000000C061400000000000004F400000000000E060400000000000804B40000000000000604000000000000048400000000000C05D4000000000000046400000000000805B4000000000008044400000000000005940000000000000444000000000008056400000000000804440000000000040544000000000000046400000000000005240000000000000484000000000004050400000000000804B400000000000004D400000000000004F400000000000004B400000000000C051400000000000804940000000000000544000000000000049400000000000805640000000000080494000000000000059400000000000004B400000000000405B400000000000004D400000000000805D4000000000004050400000000000405F40000000000000524000000000008060400000000000405440000000000000614000000000008056400000000000606140000000000000594000000000008061400000000000805B4000000000006061400000000000C05D400000000000006140000000000000604000000000008060400000000000E060400000000000405F400000000000C061400000000000805D4000000000004062400000000000405B400000000000A0624000000000000059400000000000C062400000000000805640

query T
SELECT ST_ASTEXT(g) FROM geographies
----
MULTIPOLYGON(((743238 2967416,743238 2967450,743265 2967450,743265.625 2967416,743238 2967416)))
MULTILINESTRING((-89.734635 31.492072,-89.1001 31.22),(-89.734635 31.492072,-89.734956 31.492237))
MULTIPOLYGON(((743238 2967416,743238 2967450,743265 2967450,743265.625 2967416,743238 2967416)))
MULTIPOLYGON(((186 194,187 194,188 195,189 195,190 195,191 195,192 195,193 194,194 194,194 193,195 192,195 191,195 190,195 189,195 188,194 187,194 186,14 6,13 6,12 5,11 5,10 5,9 5,8 5,7 6,6 6,6 7,5 8,5 9,5 10,5 11,5 12,6 13,6 14,186 194)),((150 90,149 80,146 71,142 62,135 55,128 48,119 44,110 41,100 40,90 41,81 44,72 48,65 55,58 62,54 71,51 80,50 90,51 100,54 109,58 118,65 125,72 132,81 136,90 139,100 140,110 139,119 136,128 132,135 125,142 118,146 109,149 100,150 90)))

statement error
INSERT INTO geographies(('010600000002000000010300000001000000230000000000000000406740000000000040684000000000006067400000000000406840000000000080674000000000006068400000000000A0674000000000006068400000000000C0674000000000006068400000000000E067400000000000606840000000000000684000000000006068400000000000206840000000000040684000000000004068400000000000406840000000000040684000000000002068400000000000606840000000000000684000000000006068400000000000E0674000000000006068400000000000C0674000000000006068400000000000A067400000000000606840000000000080674000000000004068400000000000606740000000000040684000000000004067400000000000002C4000000000000018400000000000002A40000000000000184000000000000028400000000000001440000000000000264000000000000014400000000000002440000000000000144000000000000022400000000000001440000000000000204000000000000014400000000000001C4000000000000018400000000000001840000000000000184000000000000018400000000000001C40000000000000144000000000000020400000000000001440000000000000224000000000000014400000000000002440000000000000144000000000000026400000000000001440000000000000284000000000000018400000000000002A4000000000000018400000000000002C4000000000004067400000000000406840010300000001000000210000000000000000C0624000000000008056400000000000A06240000000000000544000000000004062400000000000C051400000000000C061400000000000004F400000000000E060400000000000804B40000000000000604000000000000048400000000000C05D4000000000000046400000000000805B4000000000008044400000000000005940000000000000444000000000008056400000000000804440000000000040544000000000000046400000000000005240000000000000484000000000004050400000000000804B400000000000004D400000000000004F400000000000004B400000000000C051400000000000804940000000000000544000000000000049400000000000805640000000000080494000000000000059400000000000004B400000000000405B400000000000004D400000000000805D4000000000004050400000000000405F40000000000000524000000000008060400000000000405440000000000000614000000000008056400000000000606140000000000000594000000000008061400000000000805B4000000000006061400000000000C05D400000000000006140000000000000604000000000008060400000000000E060400000000000405F400000000000C061400000000000805D4000000000004062400000000000405B400000000000A0624000000000000059400000000000C06240000000000080564011'))

# Insert valid strings with text
statement ok
DELETE FROM geographies

statement ok
INSERT INTO geographies VALUES('MULTIPOLYGON(((743238 2967416,743238 2967450,743265 2967450,743265.625 2967416,743238 2967416)))'), ('MULTIPOLYGON(((26 125,26 200,126 200,126 125,101 100,26 125),(51 150,101 150,76 175,51 150)),((151 100,151 200,176 175,151 100)))'), ('MULTIPOLYGON(((186 194,187 194,188 195,189 195,190 195,191 195,192 195,193 194,194 194,194 193,195 192,195 191,195 190,195 189,195 188,194 187,194 186,14 6,13 6,12 5,11 5,10 5,9 5,8 5,7 6,6 6,6 7,5 8,5 9,5 10,5 11,5 12,6 13,6 14,186 194)),((150 90,149 80,146 71,142 62,135 55,128 48,119 44,110 41,100 40,90 41,81 44,72 48,65 55,58 62,54 71,51 80,50 90,51 100,54 109,58 118,65 125,72 132,81 136,90 139,100 140,110 139,119 136,128 132,135 125,142 118,146 109,149 100,150 90)))')

query T
SELECT * FROM geographies
----
01060000000100000001030000000100000005000000000000008CAE264100000000BCA34641000000008CAE264100000000CDA3464100000000C2AE264100000000CDA3464100000040C3AE264100000000BCA34641000000008CAE264100000000BCA34641
010600000002000000010300000002000000060000000000000000003A400000000000405F400000000000003A4000000000000069400000000000805F4000000000000069400000000000805F400000000000405F40000000000040594000000000000059400000000000003A400000000000405F400400000000000000008049400000000000C0624000000000004059400000000000C0624000000000000053400000000000E0654000000000008049400000000000C06240010300000001000000040000000000000000E0624000000000000059400000000000E06240000000000000694000000000000066400000000000E065400000000000E062400000000000005940
010600000002000000010300000001000000230000000000000000406740000000000040684000000000006067400000000000406840000000000080674000000000006068400000000000A0674000000000006068400000000000C0674000000000006068400000000000E067400000000000606840000000000000684000000000006068400000000000206840000000000040684000000000004068400000000000406840000000000040684000000000002068400000000000606840000000000000684000000000006068400000000000E0674000000000006068400000000000C0674000000000006068400000000000A067400000000000606840000000000080674000000000004068400000000000606740000000000040684000000000004067400000000000002C4000000000000018400000000000002A40000000000000184000000000000028400000000000001440000000000000264000000000000014400000000000002440000000000000144000000000000022400000000000001440000000000000204000000000000014400000000000001C4000000000000018400000000000001840000000000000184000000000000018400000000000001C40000000000000144000000000000020400000000000001440000000000000224000000000000014400000000000002440000000000000144000000000000026400000000000001440000000000000284000000000000018400000000000002A4000000000000018400000000000002C4000000000004067400000000000406840010300000001000000210000000000000000C0624000000000008056400000000000A06240000000000000544000000000004062400000000000C051400000000000C061400000000000004F400000000000E060400000000000804B40000000000000604000000000000048400000000000C05D4000000000000046400000000000805B4000000000008044400000000000005940000000000000444000000000008056400000000000804440000000000040544000000000000046400000000000005240000000000000484000000000004050400000000000804B400000000000004D400000000000004F400000000000004B400000000000C051400000000000804940000000000000544000000000000049400000000000805640000000000080494000000000000059400000000000004B400000000000405B400000000000004D400000000000805D4000000000004050400000000000405F40000000000000524000000000008060400000000000405440000000000000614000000000008056400000000000606140000000000000594000000000008061400000000000805B4000000000006061400000000000C05D400000000000006140000000000000604000000000008060400000000000E060400000000000405F400000000000C061400000000000805D4000000000004062400000000000405B400000000000A0624000000000000059400000000000C062400000000000805640

query T
SELECT ST_ASTEXT(g) FROM geographies
----
MULTIPOLYGON(((743238 2967416,743238 2967450,743265 2967450,743265.625 2967416,743238 2967416)))
MULTIPOLYGON(((26 125,26 200,126 200,126 125,101 100,26 125),(51 150,101 150,76 175,51 150)),((151 100,151 200,176 175,151 100)))
MULTIPOLYGON(((186 194,187 194,188 195,189 195,190 195,191 195,192 195,193 194,194 194,194 193,195 192,195 191,195 190,195 189,195 188,194 187,194 186,14 6,13 6,12 5,11 5,10 5,9 5,8 5,7 6,6 6,6 7,5 8,5 9,5 10,5 11,5 12,6 13,6 14,186 194)),((150 90,149 80,146 71,142 62,135 55,128 48,119 44,110 41,100 40,90 41,81 44,72 48,65 55,58 62,54 71,51 80,50 90,51 100,54 109,58 118,65 125,72 132,81 136,90 139,100 140,110 139,119 136,128 132,135 125,142 118,146 109,149 100,150 90)))

statement error
INSERT INTO geographies(('MULTIPOLYGON(-71.064544 42.28787)'))

# Insert valid strings with geojson
statement ok
DELETE FROM geographies

statement ok
INSERT INTO geographies VALUES('{"type":"MultiPolygon","coordinates":[[[[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,32],[-117,32],[-117,32],[-117,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-117,32],[-117,32],[-117,32],[-117,32]],[[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,32],[-117,33]]]]}'), ('{"type":"MultiPolygon","coordinates":[[[[4,0],[0,-4],[-4,0],[0,4],[4,0]],[[2,0],[0,2],[-2,0],[0,-2],[2,0]]],[[[24,0],[20,-4],[16,0],[20,4],[24,0]],[[22,0],[20,2],[18,0],[20,-2],[22,0]]],[[[44,0],[40,-4],[36,0],[40,4],[44,0]],[[42,0],[40,2],[38,0],[40,-2],[42,0]]]]}')

query T
SELECT * FROM geographies
----
0106000000010000000103000000020000002B0000000000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000005DC000000000000040400000000000005DC000000000000040400000000000005DC000000000000040400000000000005DC000000000000040400000000000005DC000000000000040400000000000005DC000000000000040400000000000005DC000000000000040400000000000005DC000000000000040400000000000005DC000000000000040400000000000005DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC00000000000004040070000000000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000000040400000000000405DC00000000000804040
0106000000030000000103000000020000000500000000000000000010400000000000000000000000000000000000000000000010C000000000000010C00000000000000000000000000000000000000000000010400000000000001040000000000000000005000000000000000000004000000000000000000000000000000000000000000000004000000000000000C00000000000000000000000000000000000000000000000C0000000000000004000000000000000000103000000020000000500000000000000000038400000000000000000000000000000344000000000000010C000000000000030400000000000000000000000000000344000000000000010400000000000003840000000000000000005000000000000000000364000000000000000000000000000003440000000000000004000000000000032400000000000000000000000000000344000000000000000C0000000000000364000000000000000000103000000020000000500000000000000000046400000000000000000000000000000444000000000000010C000000000000042400000000000000000000000000000444000000000000010400000000000004640000000000000000005000000000000000000454000000000000000000000000000004440000000000000004000000000000043400000000000000000000000000000444000000000000000C000000000000045400000000000000000

query T
SELECT ST_ASTEXT(g) FROM geographies
----
MULTIPOLYGON(((-117 32,-117 32,-117 32,-117 32,-117 32,-117 32,-117 32,-117 32,-117 32,-117 32,-117 32,-117 32,-117 32,-117 33,-117 33,-117 33,-117 33,-117 33,-117 33,-117 33,-117 33,-117 33,-117 33,-117 33,-117 33,-117 32,-117 32,-117 32,-117 32,-116 32,-116 32,-116 32,-116 32,-116 32,-116 32,-116 32,-116 32,-116 32,-116 32,-117 32,-117 32,-117 32,-117 32),(-117 33,-117 33,-117 33,-117 33,-117 33,-117 32,-117 33)))
MULTIPOLYGON(((4 0,0 -4,-4 0,0 4,4 0),(2 0,0 2,-2 0,0 -2,2 0)),((24 0,20 -4,16 0,20 4,24 0),(22 0,20 2,18 0,20 -2,22 0)),((44 0,40 -4,36 0,40 4,44 0),(42 0,40 2,38 0,40 -2,42 0)))

# Insert invalid geojson string
statement error
INSERT INTO geographies(('{"type":"MultiPolygon","coordinates":[[30,10.2323]}'))
